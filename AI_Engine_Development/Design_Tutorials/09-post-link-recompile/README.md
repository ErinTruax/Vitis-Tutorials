<table>
 <tr>
   <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>Post-Link Recompile of an AI Engine Application</h1>
   </td>
 </tr>

</table>

***Version: Vitis 2022.1***


# Introduction

AI Engine application development can start early in the system development stage. Little by little, the AI Engine development team and the Hardware development team converge to an interface between the Adaptable Engine and the AI Engine array. At some point, this interface is fixed and should not be changed. This is to avoid a complete Vivado® tool run, which can take a long time if timing closure requires specific attention.

There are 2 ways to perform this operation:
1. Recompile the AI Engine application right after the link stage, using specific constraints to set the interface ports.
2. Create an intermediate platform which will embed these constraints.

In the first case you have to extract the constraints from the files generated by the AI Engine compiler and use them as input constraints when you run it for the second time.

In the second case running the AI Engine tools provides a fixed platform that acts as a constraint on the AI Engine array – Adaptable Engine interface specification. This tutorial explains the complete flow, for the two cases.

This tutorial details all the steps to perform hardware emulation (**hw_emu**), but it supports also the hardware implementation flow by changing the compilation target.


# Before You Begin

This tutorial requires a number of tools and files to be installed:

* Download and install the Vitis™ software platform from [here](https://www.xilinx.com/support/download.html). See the installation instructions [here](https://docs.xilinx.com/r/en-US/ug1393-vitis-application-acceleration).
* Download and install the Vitis Embedded Base Platform [VCK190](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/embedded-platforms.html).
* Download and install the [common image](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/embedded-platforms.html) for embedded Vitis platforms for Versal® ACAP.

The AI Engine development documentation is also available [here](https://docs.xilinx.com/search/all?filters=Document_ID~%2522UG1076%2522_%2522UG1079%2522&content-lang=en-US).

Before starting this tutorial, run the following steps:

1. Set up your platform by running the `xilinx-versal-common-v2022.1/environment-setup-cortexa72-cortexa53-xilinx-linux` script as provided in the platform download. This script sets up the `SYSROOT` and `CXX` variables. If the script is not present, you _must_ run the `xilinx-versal-common-v2022.1/sdk.sh`.
2. Set up your ROOTFS to point to `xilinx-versal-common-v2022.1/rootfs.ext4`.
3. Set up your IMAGE to point to `xilinx-versal-common-v2022.1/Image`.
4. Set up your `PLATFORM_REPO_PATHS` environment variable based on where you downloaded the platform.

## Accessing the Tutorial Reference Files

1. To access the reference files, type the following into a terminal: `git clone https://github.com/Xilinx/Vitis-Tutorials`.
2. Navigate to the `PostLinkRecompile` directory.

The sub-directory `Files` contains all the source files necessary for this tutorial.

A `addon_setup.sh` script is provided to initialize the platform name.

# AI Engine Application Post-Link Recompile

There are three labs in this tutorial:

- A [Direct Recompile](DirectRecompileMakefile_Flow.md) Makefile based lab.
- 2 labs based on the creation of an intermediate platform:
    - A [Vitis Makefile](VitisMakefile_Flow.md)-based lab.
    - A [Vitis IDE](VitisIDE_Flow.md)-based lab.

Each lab is divided in two phases:

1. Creating an AI Engine application using the VCK190 platform with all necessary PL kernels added, and linking the complete system.
2. Creating a new AI Engine application with interface location constrains (Lab 1) or with the previously created fixed platform (Labs 2 and 3), adding a PS application, and running hardware emulation.


# Objectives

This tutorial shows you how to modify an AI Engine application after the platform has been frozen. It demonstrates a Vitis IDE flow and a Makefile flow.

Completing this tutorial should give you confidence to develop AI Engine designs based on a hardware/software platform, knowing that you can modify the AI Engine part and the processing system control application. The only limitation is that the hardware connection between the AI Engine array and the programmable logic (PL) must be kept fixed.


---

&copy; Copyright 2021–2022 Xilinx, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

```
    http://www.apache.org/licenses/LICENSE-2.0
```

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.


<p align="center"><sup>Copyright&copy; 2021–2022 Xilinx</sup><br><sup>XD039</sup></br></p>
