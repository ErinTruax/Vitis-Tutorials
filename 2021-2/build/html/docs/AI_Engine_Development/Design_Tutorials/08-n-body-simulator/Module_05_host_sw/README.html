<div class="rst-content">

<p><em>Estimated time: less than 1 minute</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="nb">all</span>
</pre></div>
</div>
<p>or, follow steps 1 and 2 as follows:</p>
<h2>Step 1: Compile Host Software</h2>
<p>Following is an example of how to compile the <code class="docutils literal notranslate"><span class="pre">../Module_02_aie/Work_x4_x100/ps/c_rts/aie_control_xrt.cpp</span></code> file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>aarch64-linux-gnu-g++ -Wall -c -g \
                      -fmessage-length=0
                      -std=c++14 \
                      -Wno-unknown-pragmas
                      -Wno-unused-label
                      -Wno-int-to-pointer-cast
                      --sysroot=$SYSROOT
                      -I$SYSROOT/usr/include/xrt
                      -I$SYSROOT/usr/include
                      -I./
                      -I../Module_02_aie
                      -I../Module_02_aie/src
                      -I$XILINX_VITIS/aietools/include
                      -I$XILINX_VITIS/include
                      -I../Module_03_pl_kernels/Vitis_Libraries/utils/ext/xcl2
                      -I../Module_03_pl_kernels/Vitis_Libraries/utils/L1/include
                      -o ./build/aie_control_xrt.o
                      ../Module_02_aie/build/Work_x4_x100/ps/c_rts/aie_control_xrt.cpp
</pre></div>
</div>
<p>The same compilation options were used to compile the <code class="docutils literal notranslate"><span class="pre">host/nbody.cpp</span></code>, <code class="docutils literal notranslate"><span class="pre">host/log.cpp</span></code>, <code class="docutils literal notranslate"><span class="pre">host/main_xrt.cpp</span></code>, and <code class="docutils literal notranslate"><span class="pre">host/main_animate.cpp</span></code> files.</p>
<h2>Step 2: Link Host Software</h2>
<p>Following is an example of how to link the <code class="docutils literal notranslate"><span class="pre">build/aie_control.o</span></code>, <code class="docutils literal notranslate"><span class="pre">build/nbody.o</span></code>, <code class="docutils literal notranslate"><span class="pre">build/log.o</span></code>, and <code class="docutils literal notranslate"><span class="pre">build/ps_app.o</span></code> into a <code class="docutils literal notranslate"><span class="pre">build/ps_app.exe</span></code> executable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>aarch64-linux-gnu-g++ ./build/aie_control_xrt.o \
                      ./build/ps_app.o \
                      ./build/log.o \
                      ./build/nbody.o \
                      -lxaiengine -ladf_api_xrt -lxrt_core    \
                      -lxrt_coreutil -lgcc -lc -lxilinxopencl \
                      -lpthread -lrt -ldl -lcrypt -lstdc++    \
                      -lOpenCL -std=c++14                     \
                      -Wno-unused-label -Wno-narrowing        \
                      -DVERBOSE                               \
                      -L$SYSROOT/usr/lib                      \
                      --sysroot=$SYSROOT                      \  
                      -L$XILINX_VITIS/aietools/lib/aarch64.o  \
                      -o ./build/ps_app.exe
</pre></div>
</div>
<p>The same linking options were used to generate the <code class="docutils literal notranslate"><span class="pre">build/ps_app_animate.exe</span></code> executable.</p>
<p>After the full hardware design is implemented, the next step is to focus on the host software that enables the entire design. In the Vitis™ core development kit, host code is written in C++ language using the Xilinx® runtime (XRT) API. The XRT native API is described on the <a class="reference external" href="https://xilinx.github.io/XRT/2021.1/html/xrt_native_apis.html">XRT site</a>.</p>
<p>This module compiles the following host applications and custom APIs:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">host/nbody.cpp</span></code> - NbodySimulator API that implements an NBody Simulator in C++</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">host/log.cpp</span></code> - Logger API that logs messages to a file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">host/main_xrt.cpp</span></code> - Host application that compares AI Engine output to golden data (functional check)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">host/main_animate.cpp</span></code> - Host application that runs the design for multiple iterations and saves position data to a file to post-process and create an <code class="docutils literal notranslate"><span class="pre">animation.gif</span></code> later.</p></li>
</ul>
<p>The NBodySimulator API is a C++ implementation of an N-Body Simulator which runs on the native A72 processor. It also writes the position data to an <code class="docutils literal notranslate"><span class="pre">animation_data.txt</span></code> file which you will post-process later to create an <code class="docutils literal notranslate"><span class="pre">animation.gif</span></code>.</p>
<p>The Logger API is used to save logging messages from the host applications to the <code class="docutils literal notranslate"><span class="pre">run.log</span></code> file. The host application can set the log level of which messages are written to the <code class="docutils literal notranslate"><span class="pre">run.log</span></code> and which messages are shown on the console during execution. By default, the log level is set to <code class="docutils literal notranslate"><span class="pre">LMESSAGE</span></code>, meaning all messages will be written to <code class="docutils literal notranslate"><span class="pre">run.log</span></code>. The cout log level is set to <code class="docutils literal notranslate"><span class="pre">LINFO</span></code>, meaning any messages set to <code class="docutils literal notranslate"><span class="pre">LINFO</span></code> will be also displayed on the output console during execution.</p>
<h2>Log Levels:</h2>
<ul class="simple">
<li><p>LMESSAGE</p></li>
<li><p>LINFO</p></li>
<li><p>LERROR</p></li>
<li><p>LNONE</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">host/main_xrt.cpp</span></code> host application is compiled into the <code class="docutils literal notranslate"><span class="pre">build/ps_app.exe</span></code> executable. This host application reads in the <code class="docutils literal notranslate"><span class="pre">m2s_i.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">input_j.txt</span></code> files that initalize the <code class="docutils literal notranslate"><span class="pre">m2s_x2</span></code> PL kernel’s <code class="docutils literal notranslate"><span class="pre">ibuff</span></code> and <code class="docutils literal notranslate"><span class="pre">jbuff</span></code> DDR buffer inputs.  This host application starts the PL kernels and the AI Engine graph and waits for one iteration of data to flow through the design. Once the <code class="docutils literal notranslate"><span class="pre">s2m_x4</span></code> PL kernel completes, this host application compares the AI Engine output to the golden output files (<code class="docutils literal notranslate"><span class="pre">s2m_x4_k0.txt</span></code>, <code class="docutils literal notranslate"><span class="pre">s2m_x4_k1.txt</span></code>, <code class="docutils literal notranslate"><span class="pre">s2m_x4_k2.txt</span></code>, and <code class="docutils literal notranslate"><span class="pre">s2m_x4_k3.txt</span></code> files). If there are any data mismatches, then the <code class="docutils literal notranslate"><span class="pre">TEST</span> <span class="pre">FAILED</span></code>, else the <code class="docutils literal notranslate"><span class="pre">TEST</span> <span class="pre">PASSED</span></code>. If you provide the <code class="docutils literal notranslate"><span class="pre">--profile</span></code> command line input, this host application also calculates the execution times for the C++ N-Body Simulator and the AI Engine N-Body Simulator for comparison.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">host/main_animate.cpp</span></code> host application is compiled into the <code class="docutils literal notranslate"><span class="pre">build/ps_animate.exe</span></code> executable. This host application does the following:</p>
<ul class="simple">
<li><p>uses the NBodySimulator API to generate initial data (<code class="docutils literal notranslate"><span class="pre">input_i</span></code> and <code class="docutils literal notranslate"><span class="pre">input_j</span></code>)</p></li>
<li><p>save the position data (x,y,and z) for all 12,800 particles to the <code class="docutils literal notranslate"><span class="pre">animation_data.txt</span></code></p></li>
<li><p>feeds input data through the AI Engine design</p></li>
<li><p>captures the output data from the <code class="docutils literal notranslate"><span class="pre">s2m_x4</span></code> kernel</p></li>
<li><p>reconstructs the output data into a new <code class="docutils literal notranslate"><span class="pre">input_i</span></code> and new <code class="docutils literal notranslate"><span class="pre">input_j</span></code> arrays</p></li>
<li><p>feeds the new <code class="docutils literal notranslate"><span class="pre">input_i</span></code> and <code class="docutils literal notranslate"><span class="pre">input_j</span></code> back into the AI Engine design and computes another timesteps</p></li>
</ul>
<p>The host application repeats these actions for 300 timesteps. You can provide the <code class="docutils literal notranslate"><span class="pre">--timesteps</span> <span class="pre">&lt;num_timesteps&gt;</span></code> command line input to specify how many timesteps (iterations) the design runs for.</p>
<p>The following is the general execution flow for the host applications.</p>
<p><img alt="alt text" src="../../../../../_images/host_app_flow_chart_2.PNG"/></p>
<ul class="simple">
<li><p><a class="reference external" href="https://xilinx.github.io/XRT/master/html/index.html">XRT Documentation</a></p></li>
<li><p><a class="reference external" href="https://github.com/Xilinx/XRT">XRT Github Repo</a></p></li>
<li><p><a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1393-vitis-application-acceleration/Host-Programming">Vitis Host Application Documentation</a></p></li>
</ul>

<p>After compiling the host software, you are ready to create the sd_card.img and run the design on hardware in the next module, <a class="reference external" href="../Module_06_sd_card_and_hw_run">Module 06 - SD Card and Hardware Run</a>.</p>
<p>© Copyright 2021 Xilinx, Inc.</p>
<p>Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">licenses</span><span class="o">/</span><span class="n">LICENSE</span><span class="o">-</span><span class="mf">2.0</span>
</pre></div>
</div>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
<p align="center"><sup>XD068 | © Copyright 2021 Xilinx, Inc.</sup></p>
<footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>
</div>